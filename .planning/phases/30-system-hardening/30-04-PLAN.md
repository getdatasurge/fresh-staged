---
phase: 30-system-hardening
plan: 04
type: execute
wave: 2
depends_on: ["30-01", "30-02", "30-03"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Backend starts successfully with all hardening changes"
    - "Health endpoint returns healthy status"
    - "Security headers are present in API responses"
    - "All backend tests pass"
  artifacts: []
  key_links:
    - from: "backend/src/app.ts"
      to: "/health"
      via: "route registration"
      pattern: "healthRoutes"
---

<objective>
Verify all system hardening changes work together by running comprehensive tests and validating the backend behavior with the new security configurations.

Purpose: Ensure hardening changes don't break existing functionality and work correctly in combination
Output: Verified working system with documented test results
</objective>

<execution_context>
@/home/swoop/.claude/get-shit-done/workflows/execute-plan.md
@/home/swoop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-system-hardening/30-RESEARCH.md

# Prior plan summaries (will exist after wave 1)
@.planning/phases/30-system-hardening/30-01-SUMMARY.md
@.planning/phases/30-system-hardening/30-02-SUMMARY.md
@.planning/phases/30-system-hardening/30-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run backend test suite</name>
  <files></files>
  <action>
    Run the complete backend test suite to verify all hardening changes work correctly:

    ```bash
    cd backend && npm test
    ```

    All tests must pass. If any tests fail:
    1. Analyze the failure - is it related to helmet/body limits/timeout changes?
    2. If related to hardening changes, adjust the configuration
    3. If unrelated, document as pre-existing issue

    Common issues to watch for:
    - Tests that make requests larger than 1MB body limit
    - Tests that expect different response headers
    - Tests that take longer than 30 seconds
  </action>
  <verify>`cd backend && npm test` exits with code 0</verify>
  <done>All backend tests pass with hardening changes in place</done>
</task>

<task type="auto">
  <name>Task 2: Verify security headers and configuration</name>
  <files></files>
  <action>
    Start the backend server temporarily and verify security headers are present:

    1. Start backend in background:
       ```bash
       cd backend && timeout 10 npm run dev &
       sleep 5
       ```

    2. Check health endpoint responds:
       ```bash
       curl -s http://localhost:3000/health | head -20
       ```

    3. Check security headers are present:
       ```bash
       curl -sI http://localhost:3000/health | grep -E "(X-Content-Type|X-Frame-Options|Content-Security-Policy)"
       ```

    Expected headers (from helmet defaults):
    - X-Content-Type-Options: nosniff
    - X-Frame-Options: SAMEORIGIN
    - Content-Security-Policy: (our custom policy)

    4. Clean up background process:
       ```bash
       pkill -f "tsx watch src/index.ts" 2>/dev/null || true
       ```

    If headers are missing, helmet registration may have failed - check app.ts order.
  </action>
  <verify>
    curl response includes:
    - X-Content-Type-Options header
    - X-Frame-Options header
  </verify>
  <done>Security headers are present in HTTP responses from the backend</done>
</task>

<task type="auto">
  <name>Task 3: Verify frontend build with placeholder changes</name>
  <files></files>
  <action>
    Build the frontend to verify the supabase-placeholder changes compile correctly:

    ```bash
    npm run build
    ```

    This ensures:
    - SupabaseMigrationError class is valid TypeScript
    - All 42 files importing supabase-placeholder still compile
    - No type errors from the enhanced error handling

    If build fails with type errors in components using supabase-placeholder,
    the error class may need adjustments to match expected types.
  </action>
  <verify>`npm run build` exits with code 0</verify>
  <done>Frontend builds successfully with enhanced placeholder</done>
</task>

</tasks>

<verification>
1. Backend tests: `cd backend && npm test` - all pass
2. Frontend build: `npm run build` - succeeds
3. Security headers: Documented presence of helmet headers in responses
</verification>

<success_criteria>
- All backend tests pass (0 failures)
- Frontend builds without errors
- Security headers (X-Content-Type-Options, X-Frame-Options) present in API responses
- Health endpoint returns 200 with healthy status
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/30-system-hardening/30-04-SUMMARY.md`

Include in summary:
- Test results (pass/fail counts)
- Security headers verified
- Any issues discovered and how they were resolved
</output>
