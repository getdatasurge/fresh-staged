---
phase: 30-system-hardening
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/package.json
  - backend/package-lock.json
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - "npm audit shows no high or critical vulnerabilities that can be fixed"
    - "All fixable dependency vulnerabilities are resolved"
  artifacts:
    - path: "backend/package.json"
      provides: "Backend dependencies with security fixes applied"
    - path: "package.json"
      provides: "Frontend dependencies with security fixes applied"
  key_links: []
---

<objective>
Run npm audit fix on both frontend and backend to address known dependency vulnerabilities identified in the security research.

Purpose: Eliminate fixable dependency vulnerabilities without breaking changes
Output: Updated package.json and package-lock.json files with security patches applied
</objective>

<execution_context>
@/home/swoop/.claude/get-shit-done/workflows/execute-plan.md
@/home/swoop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-system-hardening/30-RESEARCH.md

# Key files
@backend/package.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run npm audit fix on backend</name>
  <files>backend/package.json, backend/package-lock.json</files>
  <action>
    Run npm audit fix WITHOUT --force to apply only non-breaking security fixes:

    ```bash
    cd backend && npm audit fix
    ```

    Do NOT use `--force` flag as it may introduce breaking changes by upgrading to new major versions.

    After running, capture the remaining vulnerabilities with `npm audit` and document
    any that cannot be fixed without breaking changes (these are acceptable to leave).

    Known unfixable (from research):
    - elliptic via @stackframe/stack-shared (low severity, no fix available)
    - vite/esbuild vulnerabilities (dev dependencies only, moderate severity)

    These are acceptable because:
    - elliptic: Transitive dependency of Stack Auth SDK, fix must come from upstream
    - vite/esbuild: Dev-only dependencies, not in production bundle
  </action>
  <verify>
    1. `cd backend && npm audit` shows no HIGH or CRITICAL vulnerabilities with available fixes
    2. `cd backend && npm run build` succeeds (no breaking changes introduced)
    3. `cd backend && npm test` passes
  </verify>
  <done>Backend dependencies have all available security patches applied, build and tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Run npm audit fix on frontend</name>
  <files>package.json, package-lock.json</files>
  <action>
    Run npm audit fix on the root frontend package:

    ```bash
    npm audit fix
    ```

    Do NOT use `--force` flag.

    After running, verify the frontend still builds and works:
    ```bash
    npm run build
    ```

    Document any remaining vulnerabilities that cannot be fixed.
  </action>
  <verify>
    1. `npm audit` shows no HIGH or CRITICAL vulnerabilities with available fixes
    2. `npm run build` succeeds
    3. `npm run lint` passes (if configured)
  </verify>
  <done>Frontend dependencies have all available security patches applied, build passes</done>
</task>

</tasks>

<verification>
1. Backend security:
   - `cd backend && npm audit` - document remaining vulnerabilities
   - `cd backend && npm run build` - must succeed
   - `cd backend && npm test` - must pass

2. Frontend security:
   - `npm audit` - document remaining vulnerabilities
   - `npm run build` - must succeed
</verification>

<success_criteria>
- npm audit fix run on both frontend and backend
- No HIGH or CRITICAL vulnerabilities remain that have available fixes
- Both frontend and backend build successfully
- Backend tests pass
- Any remaining vulnerabilities are documented with rationale (upstream dependency issues, dev-only, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/30-system-hardening/30-02-SUMMARY.md`

Include in summary:
- Vulnerabilities fixed (count and severity)
- Vulnerabilities remaining (with rationale why they cannot be fixed)
- Build/test verification results
</output>
