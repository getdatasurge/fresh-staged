---
phase: 37-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/SELFHOSTED_DEPLOYMENT.md
  - docs/deployment/deploy-guide.md
autonomous: true

must_haves:
  truths:
    - "User can identify exact VM specs needed (CPU, RAM, disk) from prerequisites"
    - "User can configure DNS records correctly before deployment"
    - "User can verify firewall requirements are met"
    - "User can gather all required external service credentials"
  artifacts:
    - path: "docs/SELFHOSTED_DEPLOYMENT.md"
      provides: "Updated prerequisites section with comprehensive requirements"
      contains: "deploy-automated.sh"
    - path: "docs/deployment/deploy-guide.md"
      provides: "Quick reference pointing to detailed guide"
      contains: "SELFHOSTED_DEPLOYMENT.md"
  key_links:
    - from: "docs/deployment/deploy-guide.md"
      to: "docs/SELFHOSTED_DEPLOYMENT.md"
      via: "cross-reference link"
      pattern: "\\[.*\\]\\(.*SELFHOSTED_DEPLOYMENT.md"
---

<objective>
Update prerequisites documentation (DOCS-01) so users can prepare their VM without asking questions.

Purpose: Users need clear, complete prerequisites to avoid deployment failures from missing DNS, wrong VM specs, or missing credentials. The existing docs reference old scripts and have incomplete requirements.

Output: Updated SELFHOSTED_DEPLOYMENT.md prerequisites section and aligned deploy-guide.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/SELFHOSTED_DEPLOYMENT.md
@docs/deployment/deploy-guide.md
@scripts/deploy-automated.sh
@scripts/lib/preflight-lib.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SELFHOSTED_DEPLOYMENT.md Prerequisites Section</name>
  <files>docs/SELFHOSTED_DEPLOYMENT.md</files>
  <action>
Update the Prerequisites section (lines 42-70) and DNS Configuration section (lines 74-103) of docs/SELFHOSTED_DEPLOYMENT.md:

1. **Server Requirements Table** - Keep existing table but add notes:
   - Minimum: 4 vCPU, 8 GB RAM, 100 GB SSD (deployment will fail preflight if less)
   - Recommended: 4+ vCPU, 16 GB RAM, 200 GB SSD (for growth)
   - Add note: "preflight.sh validates these requirements automatically"

2. **External Services Checklist** - Expand with specific fields:
   ```markdown
   **Required:**
   - [ ] Domain name with DNS access
     - Primary domain (e.g., freshtrack.example.com)
     - Subdomain for monitoring (monitoring.example.com)
   - [ ] Stack Auth account (https://stack-auth.com)
     - Project ID (found in dashboard settings)
     - Publishable Key (pk_...)
     - Secret Key (sk_...) - store securely

   **Optional:**
   - [ ] Telnyx account for SMS (API Key, Messaging Profile ID, Phone Number)
   - [ ] TTN account for LoRaWAN (Application ID, API Key)
   ```

3. **DNS Configuration** - Add complete record table:
   ```markdown
   | Type | Name | Value | Required | Purpose |
   |------|------|-------|----------|---------|
   | A | @ | SERVER_IP | Yes | Main application |
   | A | monitoring | SERVER_IP | Yes | Grafana/Prometheus |
   | A | status | SERVER_IP | No | Uptime Kuma |
   ```

4. **Firewall Requirements** - Add new subsection:
   ```markdown
   ### Firewall Requirements

   Ensure these ports are accessible BEFORE deployment:

   | Port | Protocol | Direction | Purpose |
   |------|----------|-----------|---------|
   | 22 | TCP | Inbound | SSH access |
   | 80 | TCP | Inbound | HTTP (Let's Encrypt challenge) |
   | 443 | TCP | Inbound | HTTPS (production traffic) |

   The deployment script configures UFW automatically, but cloud provider firewalls must be configured manually.
   ```

5. **Pre-Deployment Checklist** - Add new section after DNS:
   ```markdown
   ### Pre-Deployment Checklist

   Complete this checklist BEFORE running deploy-automated.sh:

   - [ ] VM provisioned with minimum specs (4 vCPU, 8 GB RAM)
   - [ ] SSH access confirmed: `ssh root@YOUR_IP`
   - [ ] DNS A records created for domain and monitoring subdomain
   - [ ] DNS propagated: `dig yourdomain.com +short` returns server IP
   - [ ] Cloud firewall allows ports 22, 80, 443 inbound
   - [ ] Stack Auth credentials ready (Project ID, Publishable Key, Secret Key)
   ```

6. Update Overview section to reference `deploy-automated.sh` instead of `deploy-selfhosted.sh`.

Keep all other sections unchanged. Preserve existing troubleshooting content.
  </action>
  <verify>
Verify updated sections exist:
- grep "deploy-automated.sh" docs/SELFHOSTED_DEPLOYMENT.md (should find references)
- grep "Pre-Deployment Checklist" docs/SELFHOSTED_DEPLOYMENT.md (should find section)
- grep "Firewall Requirements" docs/SELFHOSTED_DEPLOYMENT.md (should find section)
  </verify>
  <done>Prerequisites section includes complete VM specs, DNS records table, firewall requirements, and pre-deployment checklist</done>
</task>

<task type="auto">
  <name>Task 2: Update deploy-guide.md Quick Reference</name>
  <files>docs/deployment/deploy-guide.md</files>
  <action>
Update docs/deployment/deploy-guide.md to be a concise quick-start that points to SELFHOSTED_DEPLOYMENT.md for details:

1. **Prerequisites Section** - Replace with reference:
   ```markdown
   ## Prerequisites

   Before deploying, complete the full prerequisites checklist:
   **[See SELFHOSTED_DEPLOYMENT.md Prerequisites](../SELFHOSTED_DEPLOYMENT.md#prerequisites)**

   Quick requirements:
   - Ubuntu 22.04/24.04 LTS
   - 4+ vCPU, 8+ GB RAM, 100+ GB SSD
   - Domain with DNS pointing to server
   - Stack Auth account credentials
   ```

2. **Quick Start** - Keep but update:
   - Step 1: Clone repository (keep as-is)
   - Step 2: Run `chmod +x scripts/deploy-automated.sh && sudo ./scripts/deploy-automated.sh`
   - Add note: "The script is checkpoint-based and will resume from last successful step if interrupted"

3. **Post-Deployment** - Update to reference new scripts:
   ```markdown
   ## Post-Deployment

   After deployment completes:

   1. **Verify installation:**
      ```bash
      ./scripts/verify-deployment.sh your-domain.com
      ```

   2. **Complete setup:**
      ```bash
      ./scripts/post-deploy.sh your-domain.com
      ```

   3. **Access dashboard:** `https://your-domain.com`
   ```

4. **Troubleshooting** - Replace with reference:
   ```markdown
   ## Troubleshooting

   For detailed troubleshooting, see:
   **[SELFHOSTED_DEPLOYMENT.md Troubleshooting](../SELFHOSTED_DEPLOYMENT.md#troubleshooting)**

   Quick fixes:
   - Resume after failure: `sudo ./scripts/deploy-automated.sh` (auto-resumes)
   - Start fresh: `sudo ./scripts/deploy-automated.sh --reset`
   ```

5. Keep header and overview concise (this is a quick reference, not the full guide).
  </action>
  <verify>
Verify references are correct:
- grep "SELFHOSTED_DEPLOYMENT.md" docs/deployment/deploy-guide.md (should find links)
- grep '\[.*\](.*SELFHOSTED_DEPLOYMENT.md' docs/deployment/deploy-guide.md (should find markdown links)
- grep "verify-deployment.sh" docs/deployment/deploy-guide.md (should find reference)
- grep "post-deploy.sh" docs/deployment/deploy-guide.md (should find reference)
  </verify>
  <done>deploy-guide.md serves as quick reference that points to SELFHOSTED_DEPLOYMENT.md for details</done>
</task>

</tasks>

<verification>
1. Prerequisites documentation is comprehensive:
   - VM specs clearly stated with minimum and recommended
   - DNS records table complete with all required records
   - Firewall requirements documented
   - Pre-deployment checklist included

2. Documentation references correct scripts:
   - deploy-automated.sh (not deploy-selfhosted.sh)
   - verify-deployment.sh
   - post-deploy.sh

3. Cross-references work:
   - deploy-guide.md links to SELFHOSTED_DEPLOYMENT.md
</verification>

<success_criteria>
- User can identify exact VM specs from reading prerequisites (4 vCPU, 8 GB RAM, 100 GB SSD minimum)
- User can configure correct DNS records from the table
- User can verify firewall requirements are met before deployment
- User can use pre-deployment checklist to confirm readiness
</success_criteria>

<output>
After completion, create `.planning/phases/37-documentation/37-01-SUMMARY.md`
</output>
