---
phase: 20-backend-api-migration-core
plan: 05
type: execute
wave: 4
depends_on: ["20-04"]
files_modified:
  - src/hooks/useAlerts.ts
  - src/hooks/useUnits.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Frontend hooks compile without TypeScript errors"
    - "AlertStatusFilter matches backend AlertStatusSchema ('active' not 'pending')"
    - "Unit mutation types use tempMin/tempMax (required) not minTemp/maxTemp (optional)"
  artifacts:
    - path: "src/hooks/useAlerts.ts"
      provides: "Correct AlertStatusFilter type"
      contains: "'active'"
    - path: "src/hooks/useUnits.ts"
      provides: "Correct unit schema field names"
      contains: "tempMin"
  key_links:
    - from: "src/hooks/useAlerts.ts"
      to: "backend/src/schemas/alerts.ts"
      via: "type alignment"
      pattern: "active.*acknowledged.*resolved.*escalated"
    - from: "src/hooks/useUnits.ts"
      to: "backend/src/schemas/units.ts"
      via: "type alignment"
      pattern: "tempMin.*tempMax"
---

<objective>
Fix TypeScript type mismatches between frontend hooks and backend tRPC schemas.

Purpose: Close verification gaps from Phase 20 — the backend routers and services work correctly, but the frontend hook type definitions use incorrect field names and values that cause TypeScript compilation errors.

Output: Frontend hooks that compile cleanly and match backend schema contracts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Backend schemas (source of truth)
@backend/src/schemas/alerts.ts
@backend/src/schemas/units.ts

# Files to fix
@src/hooks/useAlerts.ts
@src/hooks/useUnits.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix AlertStatusFilter type in useAlerts.ts</name>
  <files>src/hooks/useAlerts.ts</files>
  <action>
Change the AlertStatusFilter type definition from 'pending' to 'active' to match the backend AlertStatusSchema.

Current (line 38):
```typescript
export type AlertStatusFilter = 'pending' | 'acknowledged' | 'resolved' | 'escalated';
```

Fix to:
```typescript
export type AlertStatusFilter = 'active' | 'acknowledged' | 'resolved' | 'escalated';
```

This matches the backend AlertStatusSchema in backend/src/schemas/alerts.ts:
```typescript
export const AlertStatusSchema = z.enum([
  'active',
  'acknowledged',
  'resolved',
  'escalated',
]);
```

Also update the JSDoc example on line 11 from `status: 'pending'` to `status: 'active'`.
  </action>
  <verify>Run `npx tsc --noEmit` from the project root (not backend/) to check frontend compilation</verify>
  <done>AlertStatusFilter type uses 'active' instead of 'pending', matching backend schema</done>
</task>

<task type="auto">
  <name>Task 2: Fix unit mutation types in useUnits.ts</name>
  <files>src/hooks/useUnits.ts</files>
  <action>
Fix the unit mutation types to match the backend CreateUnitSchema and UpdateUnitSchema.

**Problem 1: Field names**
Frontend uses `minTemp`/`maxTemp` but backend uses `tempMin`/`tempMax`.

**Problem 2: Required vs optional**
Backend CreateUnitSchema requires `tempMin` and `tempMax` as required fields.
Backend UpdateUnitSchema has them as optional.
Frontend has both as optional which is incorrect for create.

**Fix useCreateUnit (lines 131-137):**
Change from:
```typescript
data: {
  name: string;
  unitType?: string;
  minTemp?: number;
  maxTemp?: number;
  alertDelayMinutes?: number;
};
```

To:
```typescript
data: {
  name: string;
  unitType: 'fridge' | 'freezer' | 'display_case' | 'walk_in_cooler' | 'walk_in_freezer' | 'blast_chiller';
  tempMin: number;
  tempMax: number;
  tempUnit?: 'F' | 'C';
  manualMonitoringRequired?: boolean;
  manualMonitoringInterval?: number | null;
  sortOrder?: number;
};
```

**Fix useUpdateUnit (lines 185-191):**
Change from:
```typescript
data: {
  name?: string;
  unitType?: string;
  minTemp?: number;
  maxTemp?: number;
  alertDelayMinutes?: number;
};
```

To:
```typescript
data: {
  name?: string;
  unitType?: 'fridge' | 'freezer' | 'display_case' | 'walk_in_cooler' | 'walk_in_freezer' | 'blast_chiller';
  tempMin?: number;
  tempMax?: number;
  tempUnit?: 'F' | 'C';
  manualMonitoringRequired?: boolean;
  manualMonitoringInterval?: number | null;
  sortOrder?: number;
};
```

**Update JSDoc examples** (lines 21-22 and 117 and 170):
- Change `minTemp: -25, maxTemp: -18` to `tempMin: -25, tempMax: -18`

Note: `alertDelayMinutes` is not in the backend schema — remove it from both types.
  </action>
  <verify>Run `npx tsc --noEmit` from the project root to verify no TypeScript errors</verify>
  <done>Unit hook types use correct field names (tempMin/tempMax) with correct optionality matching backend schemas</done>
</task>

<task type="auto">
  <name>Task 3: Verify full TypeScript compilation</name>
  <files>src/hooks/useAlerts.ts, src/hooks/useUnits.ts</files>
  <action>
Run full TypeScript compilation check for both frontend and backend to ensure:
1. No type errors in modified files
2. No regressions in other files that import these hooks
3. Backend types still compile correctly

Commands:
```bash
# Frontend TypeScript check
cd /home/skynet/freshtrack-pro-local/fresh-staged && npx tsc --noEmit

# Backend TypeScript check (should still pass)
cd /home/skynet/freshtrack-pro-local/fresh-staged/backend && npx tsc --noEmit
```

If any errors appear, fix them before completing the task.
  </action>
  <verify>Both `npx tsc --noEmit` commands pass with exit code 0</verify>
  <done>Frontend and backend TypeScript compilation passes without errors</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in project root (frontend)
2. `cd backend && npx tsc --noEmit` passes (backend)
3. `AlertStatusFilter` type contains 'active' (not 'pending')
4. Unit hooks use `tempMin`/`tempMax` field names
5. `useCreateUnit` requires `tempMin` and `tempMax` (not optional)
6. No grep matches for 'pending' in useAlerts.ts AlertStatusFilter
7. No grep matches for 'minTemp' or 'maxTemp' in useUnits.ts
</verification>

<success_criteria>
- TypeScript compilation passes for entire codebase (frontend + backend)
- Frontend hooks type definitions match backend tRPC schema contracts
- VERIFICATION.md gap "Frontend hooks use tRPC with proper TypeScript types" can now pass re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/20-backend-api-migration-core/20-05-SUMMARY.md`
</output>
