---
phase: 27
plan: 02
wave: 2
gap_closure: false
---

# Plan 27-02: TTN Bootstrap Service

## Goal
Port the provisioning and bootstrapping logic from `ttn-bootstrap` and `ttn-provision-org`.

## Requirements
- Implement `TtnProvisioningService` class.
- Support `validate_only` and `save_and_configure` actions.
- interact with Drizzle `ttn_connections` table.

## Tasks

<task>
<name>Implement Provisioning Service</name>
<description>
Create `backend/src/services/ttn/provisioning.ts`.
- `validateConfiguration(apiKey, appId, region)`
- `provisionOrganization(apiKey, appId, region)`: Saves to DB, sets up webhook.
- Use `TtnClient` for API calls.
</description>
<file>backend/src/services/ttn/provisioning.ts</file>
<verify>
grep "provisionOrganization" backend/src/services/ttn/provisioning.ts
</verify>
</task>

<task>
<name>Migrate Obfuscation Logic</name>
<description>
Port key obfuscation/deobfuscation logic from `ttnConfig.ts` to `backend/src/lib/crypto.ts` (or similar).
Ensure it supports the legacy format for backward compatibility.
</description>
<file>backend/src/services/ttn/crypto.ts</file>
<verify>
grep "deobfuscateKey" backend/src/services/ttn/crypto.ts
</verify>
</task>
