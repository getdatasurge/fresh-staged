---
phase: 27
plan: 03
wave: 2
gap_closure: false
---

# Plan 27-03: TTN Settings & Webhook Services

## Goal

Port `manage-ttn-settings` and `update-ttn-webhook` logic to backend services.

## Requirements

- Implement `TtnSettingsService` for basic CRUD + Connection Testing.
- Implement `TtnWebhookService` for webhook URL/Event updates.

## Tasks

<task>
<name>Implement Settings Service</name>
<description>
Create `backend/src/services/ttn/settings.ts`.
- `getSettings(orgId)`
- `updateSettings(orgId, updates)`
- `testConnection(orgId, deviceId?)` - Ports `testTtnConnection` logic.
</description>
<file>backend/src/services/ttn/settings.ts</file>
<verify>
grep "testConnection" backend/src/services/ttn/settings.ts
</verify>
</task>

<task>
<name>Implement Webhook Service</name>
<description>
Create `backend/src/services/ttn/webhook.ts`.
- `updateWebhook(orgId, url, events)`
- `regenerateSecret(orgId)`
- Takes care of calling TTN API `ApplicationWebhookRegistry` (via generic HTTP).
</description>
<file>backend/src/services/ttn/webhook.ts</file>
<verify>
grep "updateWebhook" backend/src/services/ttn/webhook.ts
</verify>
</task>
