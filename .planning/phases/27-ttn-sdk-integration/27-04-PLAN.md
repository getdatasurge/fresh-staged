---
phase: 27
plan: 04
wave: 3
gap_closure: false
---

# Plan 27-04: tRPC Router Implementation

## Goal

Expose the new TTN services via a tRPC router, enabling frontend access.

## Requirements

- Create `backend/src/routers/ttnSettings.ts`.
- Procedures:
  - `get`: Returns settings for org.
  - `update`: Updates settings.
  - `testConnection`: Runs connection test.
  - `validateApiKey`: Preflight validation.
  - `saveAndConfigure`: Bootstraps keys.
  - `updateWebhook`: Updates webhook config.
  - `regenerateWebhookSecret`: Rotates secret.

## Tasks

<task>
<name>Create TTN Router</name>
<description>
Implement the router with Zod input validation matching `src/lib/validation.ts` schemas.
Inject services via context or instantiate directly.
</description>
<file>backend/src/routers/ttnSettings.ts</file>
<verify>
grep "ttnSettingsRouter" backend/src/routers/ttnSettings.ts
</verify>
</task>

<task>
<name>Register Router</name>
<description>
Add `ttnSettings` to `backend/src/routers/index.ts`.
</description>
<file>backend/src/routers/index.ts</file>
<verify>
grep "ttnSettings" backend/src/routers/index.ts
</verify>
</task>
