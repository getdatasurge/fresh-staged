---
phase: 05-frontend-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/api/organizations.ts
  - src/lib/api/sites.ts
  - src/lib/api/areas.ts
  - src/lib/api/units.ts
  - src/lib/api/index.ts
autonomous: true

must_haves:
  truths:
    - "API functions exist for all CRUD operations on org, site, area, unit"
    - "All functions accept accessToken parameter for authentication"
    - "Functions return typed responses matching api-types.ts"
  artifacts:
    - path: "src/lib/api/organizations.ts"
      provides: "Organization API functions"
      exports: ["getOrganization", "updateOrganization", "listMembers"]
    - path: "src/lib/api/sites.ts"
      provides: "Site CRUD API functions"
      exports: ["listSites", "getSite", "createSite", "updateSite", "deleteSite"]
    - path: "src/lib/api/areas.ts"
      provides: "Area CRUD API functions"
      exports: ["listAreas", "getArea", "createArea", "updateArea", "deleteArea"]
    - path: "src/lib/api/units.ts"
      provides: "Unit CRUD API functions"
      exports: ["listUnits", "getUnit", "createUnit", "updateUnit", "deleteUnit"]
    - path: "src/lib/api/index.ts"
      provides: "Barrel export for all API modules"
      exports: ["organizationsApi", "sitesApi", "areasApi", "unitsApi"]
  key_links:
    - from: "src/lib/api/organizations.ts"
      to: "src/lib/api-client.ts"
      via: "import createAuthenticatedClient"
      pattern: "createAuthenticatedClient"
---

<objective>
Create typed API functions for core entity CRUD operations.

Purpose: Provide type-safe functions that hooks will use to communicate with the backend API for organizations, sites, areas, and units.

Output:
- organizationsApi module with get, update, listMembers
- sitesApi module with full CRUD
- areasApi module with full CRUD
- unitsApi module with full CRUD
- Barrel export combining all API modules
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-frontend-migration/05-RESEARCH.md
@backend/src/routes/organizations.ts
@backend/src/routes/sites.ts
@backend/src/routes/areas.ts
@backend/src/routes/units.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create organizations API module</name>
  <files>src/lib/api/organizations.ts</files>
  <action>
Create `src/lib/api/organizations.ts` with typed API functions:

```typescript
import { createAuthenticatedClient } from '../api-client';
import type { OrganizationResponse, UpdateOrganizationRequest, MemberResponse } from '../api-types';

export const organizationsApi = {
  /**
   * Get organization by ID
   * GET /api/orgs/:orgId
   */
  getOrganization: async (orgId: string, accessToken: string): Promise<OrganizationResponse> => {
    const client = createAuthenticatedClient(accessToken);
    return client.get(`api/orgs/${orgId}`).json<OrganizationResponse>();
  },

  /**
   * Update organization
   * PUT /api/orgs/:orgId
   * Requires owner role
   */
  updateOrganization: async (
    orgId: string,
    updates: UpdateOrganizationRequest,
    accessToken: string
  ): Promise<OrganizationResponse> => {
    const client = createAuthenticatedClient(accessToken);
    return client.put(`api/orgs/${orgId}`, { json: updates }).json<OrganizationResponse>();
  },

  /**
   * List organization members
   * GET /api/orgs/:orgId/members
   */
  listMembers: async (orgId: string, accessToken: string): Promise<MemberResponse[]> => {
    const client = createAuthenticatedClient(accessToken);
    return client.get(`api/orgs/${orgId}/members`).json<MemberResponse[]>();
  },
};
```

Each function:
- Accepts accessToken as final parameter
- Uses createAuthenticatedClient for auth header injection
- Returns properly typed response
- Has JSDoc with HTTP method and route
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>organizationsApi exports getOrganization, updateOrganization, listMembers functions</done>
</task>

<task type="auto">
  <name>Task 2: Create sites, areas, units API modules</name>
  <files>src/lib/api/sites.ts, src/lib/api/areas.ts, src/lib/api/units.ts</files>
  <action>
Create CRUD API modules for sites, areas, and units following the same pattern as organizations.

**src/lib/api/sites.ts:**
```typescript
export const sitesApi = {
  listSites: async (orgId: string, accessToken: string): Promise<SiteResponse[]> => {...},
  getSite: async (orgId: string, siteId: string, accessToken: string): Promise<SiteResponse> => {...},
  createSite: async (orgId: string, data: CreateSiteRequest, accessToken: string): Promise<SiteResponse> => {...},
  updateSite: async (orgId: string, siteId: string, data: UpdateSiteRequest, accessToken: string): Promise<SiteResponse> => {...},
  deleteSite: async (orgId: string, siteId: string, accessToken: string): Promise<void> => {...},
};
```

Routes:
- GET /api/orgs/:orgId/sites
- GET /api/orgs/:orgId/sites/:siteId
- POST /api/orgs/:orgId/sites
- PUT /api/orgs/:orgId/sites/:siteId
- DELETE /api/orgs/:orgId/sites/:siteId

**src/lib/api/areas.ts:**
```typescript
export const areasApi = {
  listAreas: async (orgId: string, siteId: string, accessToken: string): Promise<AreaResponse[]> => {...},
  getArea: async (orgId: string, siteId: string, areaId: string, accessToken: string): Promise<AreaResponse> => {...},
  createArea: async (orgId: string, siteId: string, data: CreateAreaRequest, accessToken: string): Promise<AreaResponse> => {...},
  updateArea: async (orgId: string, siteId: string, areaId: string, data: UpdateAreaRequest, accessToken: string): Promise<AreaResponse> => {...},
  deleteArea: async (orgId: string, siteId: string, areaId: string, accessToken: string): Promise<void> => {...},
};
```

Routes:
- GET /api/orgs/:orgId/sites/:siteId/areas
- GET /api/orgs/:orgId/sites/:siteId/areas/:areaId
- POST /api/orgs/:orgId/sites/:siteId/areas
- PUT /api/orgs/:orgId/sites/:siteId/areas/:areaId
- DELETE /api/orgs/:orgId/sites/:siteId/areas/:areaId

**src/lib/api/units.ts:**
```typescript
export const unitsApi = {
  listUnits: async (orgId: string, siteId: string, areaId: string, accessToken: string): Promise<UnitResponse[]> => {...},
  getUnit: async (orgId: string, siteId: string, areaId: string, unitId: string, accessToken: string): Promise<UnitResponse> => {...},
  createUnit: async (orgId: string, siteId: string, areaId: string, data: CreateUnitRequest, accessToken: string): Promise<UnitResponse> => {...},
  updateUnit: async (orgId: string, siteId: string, areaId: string, unitId: string, data: UpdateUnitRequest, accessToken: string): Promise<UnitResponse> => {...},
  deleteUnit: async (orgId: string, siteId: string, areaId: string, unitId: string, accessToken: string): Promise<void> => {...},
};
```

Routes:
- GET /api/orgs/:orgId/sites/:siteId/areas/:areaId/units
- GET /api/orgs/:orgId/sites/:siteId/areas/:areaId/units/:unitId
- POST /api/orgs/:orgId/sites/:siteId/areas/:areaId/units
- PUT /api/orgs/:orgId/sites/:siteId/areas/:areaId/units/:unitId
- DELETE /api/orgs/:orgId/sites/:siteId/areas/:areaId/units/:unitId

For DELETE operations, use `.json<void>()` or handle 204 No Content response.
  </action>
  <verify>TypeScript compiles without errors for all three files</verify>
  <done>sitesApi, areasApi, unitsApi all export full CRUD functions</done>
</task>

<task type="auto">
  <name>Task 3: Create API barrel export</name>
  <files>src/lib/api/index.ts</files>
  <action>
Create `src/lib/api/index.ts` that exports all API modules:

```typescript
// API modules barrel export
export { organizationsApi } from './organizations';
export { sitesApi } from './sites';
export { areasApi } from './areas';
export { unitsApi } from './units';

// Re-export types for convenience
export type * from '../api-types';
```

This allows consuming code to import like:
```typescript
import { organizationsApi, sitesApi, OrganizationResponse } from '@/lib/api';
```
  </action>
  <verify>Import statement works: `import { organizationsApi } from '@/lib/api'`</verify>
  <done>Barrel export provides single import point for all API modules</done>
</task>

</tasks>

<verification>
1. `pnpm tsc --noEmit` passes with no type errors
2. All API modules export their respective functions
3. Barrel export re-exports all modules
4. Import paths resolve correctly with @/ alias
</verification>

<success_criteria>
- organizationsApi has get, update, listMembers functions
- sitesApi has full CRUD (list, get, create, update, delete)
- areasApi has full CRUD with site hierarchy
- unitsApi has full CRUD with area hierarchy
- All functions accept accessToken for authentication
- All functions return properly typed responses
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-migration/05-02-SUMMARY.md`
</output>
