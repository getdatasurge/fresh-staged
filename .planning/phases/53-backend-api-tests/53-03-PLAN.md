---
phase: 53-backend-api-tests
plan: 03
type: execute
---

<objective>
Remove 2 skipped tests from `tests/trpc/sites.router.test.ts` (admin update, owner update). Both are exact duplicates of passing tests in `tests/api/sites.test.ts` which has 25 passing tests covering the full sites REST API.

Purpose: Eliminate the last 2 skipped backend API tests in Phase 53 scope
Output: sites.router.test.ts with 14 passing tests, 0 skipped
</objective>

<execution_context>
Read file: .planning/phases/53-backend-api-tests/53-RESEARCH.md
</execution_context>

<context>
Read file: .planning/PROJECT.md
Read file: .planning/ROADMAP.md
Read file: .planning/STATE.md
Read file: .planning/phases/53-backend-api-tests/53-RESEARCH.md

**Key context from research:**

- `backend/tests/trpc/sites.router.test.ts` has 14 passing + 2 skipped tests
- The 2 skipped tests are for the `update` procedure: "should update site when user is admin" and "should update site when user is owner"
- `backend/tests/api/sites.test.ts` has 25 passing tests including exact matches: "should update site for admin" (line 318) and "should update site for owner" (line 340)
- Root cause of skips: sites.router.ts update procedure calls `AuditService.logEvent()` which isn't mocked in the tRPC test file
- Option A (RECOMMENDED by research): Delete the 2 skipped tests since REST API file covers them
- Option B: Mock AuditService and implement — unnecessary given existing coverage

Relevant source files:
Read file: backend/tests/trpc/sites.router.test.ts
Read file: backend/tests/api/sites.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove 2 skipped site update tests</name>
  <files>backend/tests/trpc/sites.router.test.ts</files>
  <action>
Remove the 2 `it.skip(...)` blocks for:
- "should update site when user is admin"
- "should update site when user is owner"

Delete the entire `it.skip(...)` blocks. If the parent describe block becomes empty after deletion, remove it too. If other tests exist in the same describe block, keep the block.

DO NOT mock AuditService or attempt to implement these tests — the REST API file (`tests/api/sites.test.ts`) already covers both scenarios with 25 passing tests.

DO NOT modify any other tests in the file.
</action>
<verify>

1. `cd backend && npx vitest run tests/trpc/sites.router.test.ts` shows 14 passed, 0 skipped, 0 failed
2. `cd backend && npx vitest run tests/api/sites.test.ts` shows 25 passed, 0 skipped (coverage preserved)
3. grep -c 'it\.skip\|test\.skip\|describe\.skip' backend/tests/trpc/sites.router.test.ts returns 0
   </verify>
   <done>2 skipped tests removed, 14 existing tests pass, site update coverage preserved in REST API file (25 tests)</done>
   </task>

<task type="auto">
  <name>Task 2: Run full backend test suite and verify Phase 53 complete</name>
  <files>None (verification only)</files>
  <action>
Run the full backend test suite to confirm:
1. Zero new skipped tests introduced by Phase 53 changes
2. No regressions from file deletion (alerts.test.ts) or test modifications
3. Count total skipped tests remaining — should be reduced by 24 from Phase 52 baseline

Also verify requirements coverage:

- ALERT-01: alerts.test.ts skipped tests eliminated (file deleted, tRPC covers all)
- ALERT-02: Alert lifecycle tested through API layer (19 tRPC tests)
- READ-01: readings.test.ts skipped tests eliminated (5 fixed, 3 removed as dupes)
- READ-02: Reading ingestion, pagination, time filtering tested (REST ingest + tRPC query)
- SITE-01: sites.router.test.ts skipped tests eliminated (2 removed as dupes)
  </action>
  <verify>

1. `cd backend && npx vitest run` completes with 0 new failures
2. grep -r 'it\.skip\|test\.skip\|describe\.skip' backend/tests/api/alerts.test.ts returns "No such file"
3. grep -c 'it\.skip\|test\.skip' backend/tests/api/readings.test.ts returns 0
4. grep -c 'it\.skip\|test\.skip\|describe\.skip' backend/tests/trpc/sites.router.test.ts returns 0
   </verify>
   <done>Phase 53 complete — 24 skipped tests eliminated (14 alert dupes deleted, 5 readings ingest fixed, 3 readings query dupes deleted, 2 sites dupes deleted), all requirements satisfied</done>
   </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd backend && npx vitest run tests/trpc/sites.router.test.ts` — 14 passed, 0 skipped
- [ ] `cd backend && npx vitest run tests/api/sites.test.ts` — 25 passed, 0 skipped
- [ ] Zero `.skip` or `.todo` markers in sites.router.test.ts
- [ ] `cd backend && npx vitest run` — no regression from Phase 53 changes
- [ ] All 5 Phase 53 requirements (ALERT-01, ALERT-02, READ-01, READ-02, SITE-01) satisfied
</verification>

<success_criteria>

- sites.router.test.ts has 0 skipped tests (14 passing)
- sites.test.ts has 25 passing tests (update coverage preserved)
- Full backend suite has no new failures
- Phase 53 is fully complete — all 24 skipped tests across 3 files eliminated
  </success_criteria>

<must_haves>

- Zero `it.skip()`, `test.skip()`, or `describe.skip()` markers in sites.router.test.ts
- 14 existing tests in sites.router.test.ts still pass
- 25 tests in sites.test.ts still pass
- No regression in broader backend test suite
- Phase 53 complete with all 5 requirements verified
  </must_haves>

<output>
After completion, create `.planning/phases/53-backend-api-tests/53-03-SUMMARY.md`
</output>
