---
phase: 08-frontend-auth-cleanup
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Alerts.tsx
  - src/pages/RecentlyDeleted.tsx
  - src/pages/TTNCleanup.tsx
  - src/pages/PilotSetup.tsx
  - src/pages/AreaDetail.tsx
  - src/pages/Inspector.tsx
autonomous: true

must_haves:
  truths:
    - "Pages get auth state from Stack Auth"
    - "No supabase.auth calls in simple pages"
    - "Database calls preserved"
  artifacts:
    - path: "src/pages/Alerts.tsx"
      provides: "Alerts page with Stack Auth"
      contains: "useUser"
    - path: "src/pages/RecentlyDeleted.tsx"
      provides: "Recently deleted with Stack Auth"
      contains: "useUser"
  key_links:
    - from: "src/pages/Alerts.tsx"
      to: "@stackframe/react"
      via: "useUser import"
      pattern: "import.*useUser.*from.*@stackframe/react"
---

<objective>
Migrate 6 pages with simple auth patterns (1-2 auth calls) from Supabase to Stack Auth.

Purpose: These pages have straightforward auth usage for session or user ID retrieval.

Output: 6 pages migrated, no Supabase auth calls remaining.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-frontend-auth-cleanup/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Alerts, RecentlyDeleted, TTNCleanup</name>
  <files>
    src/pages/Alerts.tsx
    src/pages/RecentlyDeleted.tsx
    src/pages/TTNCleanup.tsx
  </files>
  <action>
    **Alerts.tsx (2 auth calls):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace both auth calls with Stack Auth pattern
    4. Remove supabase import if no database calls, else keep

    **RecentlyDeleted.tsx (1 auth call):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace `supabase.auth.getUser()` with `user.id`
    4. Remove supabase import if no database calls

    **TTNCleanup.tsx (1 auth call):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace `supabase.auth.getUser()` with `user.id`
    4. Remove supabase import if no database calls

    Pattern for getUser replacement:
    ```typescript
    // OLD
    const { data: { user } } = await supabase.auth.getUser();
    const userId = user?.id;

    // NEW
    const user = useUser(); // at component level
    const userId = user?.id; // direct access
    ```

    Pattern for getSession replacement:
    ```typescript
    // OLD
    const { data: { session } } = await supabase.auth.getSession();
    const token = session?.access_token;

    // NEW
    const user = useUser(); // at component level
    const { accessToken } = await user.getAuthJson();
    ```
  </action>
  <verify>
    Run `grep -c "supabase.auth" src/pages/Alerts.tsx src/pages/RecentlyDeleted.tsx src/pages/TTNCleanup.tsx` returns 0 for all
    Run `pnpm tsc --noEmit` passes
  </verify>
  <done>
    Alerts, RecentlyDeleted, TTNCleanup use Stack Auth for authentication
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate PilotSetup, AreaDetail, Inspector</name>
  <files>
    src/pages/PilotSetup.tsx
    src/pages/AreaDetail.tsx
    src/pages/Inspector.tsx
  </files>
  <action>
    **PilotSetup.tsx (1 auth call, 1 db call):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace the `supabase.auth.getSession()` call
    4. Keep the database call (supabase.from) unchanged
    5. Keep supabase import for database call

    **AreaDetail.tsx (1 auth call, 1 db call):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace the auth call with Stack Auth pattern
    4. Keep the database call unchanged

    **Inspector.tsx (2 auth calls, 1 db call):**
    1. Add `import { useUser } from "@stackframe/react"`
    2. Add `const user = useUser()` at page level
    3. Replace both auth calls with Stack Auth pattern
    4. Keep the database call unchanged

    For all three:
    - Migrate only auth calls (supabase.auth.*)
    - Preserve database calls (supabase.from, supabase.rpc, supabase.functions)
    - Keep supabase import for database operations
  </action>
  <verify>
    Run `grep -c "supabase.auth" src/pages/PilotSetup.tsx src/pages/AreaDetail.tsx src/pages/Inspector.tsx` returns 0 for all
    Run `pnpm tsc --noEmit` passes
  </verify>
  <done>
    PilotSetup, AreaDetail, Inspector use Stack Auth, database calls preserved
  </done>
</task>

</tasks>

<verification>
1. Run TypeScript check: `pnpm tsc --noEmit`
2. Search for remaining auth calls in all 6 pages
3. Verify database calls still present where needed
</verification>

<success_criteria>
- All 6 pages compile without errors
- Zero `supabase.auth` calls remain
- Stack Auth useUser() properly used
- Database calls preserved
</success_criteria>

<output>
After completion, create `.planning/phases/08-frontend-auth-cleanup/08-04-SUMMARY.md`
</output>
