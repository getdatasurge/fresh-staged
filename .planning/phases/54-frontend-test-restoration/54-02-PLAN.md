---
phase: 54-frontend-test-restoration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts
autonomous: true
must_haves:
  truths:
    - 'widgetHealthStates.test.ts has zero describe.skip blocks'
    - 'All remaining tests in widgetHealthStates.test.ts pass'
    - 'Frontend pnpm test runs with zero skipped tests in this file'
    - 'No deprecated stub functions are being tested (they were deleted tests, not code)'
  artifacts:
    - path: 'src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts'
      provides: 'Widget health state tests with zero skips'
      contains: 'Widget Health State Machine'
  key_links:
    - from: 'src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts'
      to: 'src/lib/validation/runtimeSchemaValidator'
      via: 'import schema validation functions'
      pattern: 'validatePayloadSchema|inferPayloadType'
---

<objective>
Eliminate all 12 skipped tests in widgetHealthStates.test.ts by deleting the `describe.skip('Widget Health Metrics')` block. These tests call deprecated no-op stub functions that always return zeroed defaults — they cannot pass and testing them is meaningless.

Purpose: Fulfill FE-03 — remove describe.skip so frontend test suite reports zero skipped tests
Output: `widgetHealthStates.test.ts` with 21 passing tests (current 21 non-skipped pass, 12 skipped deleted)
</objective>

<execution_context>
Read file: .planning/phases/54-frontend-test-restoration/54-RESEARCH.md
</execution_context>

<context>
Read file: .planning/PROJECT.md
Read file: .planning/ROADMAP.md
Read file: .planning/STATE.md
Read file: .planning/phases/54-frontend-test-restoration/54-RESEARCH.md

**Key decisions from research:**

- DELETE the 12 skipped tests (do NOT fix/implement them)
- The functions under test (`trackHealthChange`, `getHealthDistribution`, `hasCriticalIssues`, `getBufferedEvents`, `getFailuresByLayer`) are ALL deprecated no-op stubs in `src/lib/observability/widgetHealthMetrics.ts`
- `trackHealthChange()` just logs a deprecation warning
- `getHealthDistribution()` always returns all zeros
- `hasCriticalIssues()` always returns false
- `getBufferedEvents()` always returns empty array
- `getFailuresByLayer()` always returns all zeros
- Phase 52-53 precedent: delete duplicate/obsolete tests rather than artificially resurrecting them

**Test file structure (widgetHealthStates.test.ts, 511 lines):**

- Lines 1-159: 3 passing describe blocks (Schema Validation: 7 tests, Payload Type Inference: 6 tests, Schema Registry: 3 tests) — DO NOT TOUCH
- Lines 161-436: `describe.skip('Widget Health Metrics')` — 12 skipped tests in 4 sub-groups — DELETE ENTIRELY
- Lines 438-465: 'Widget Contracts Existence' — 1 passing test — DO NOT TOUCH
- Lines 467-511: 'Out of Order Timestamp Detection' — 4 passing tests — DO NOT TOUCH
- Total: 21 passing + 12 skipped = 33 total. After deletion: 21 passing + 0 skipped.

Relevant source files:
Read file: src/features/dashboard-layout/**tests**/widgetHealthStates.test.ts
Read file: src/lib/observability/widgetHealthMetrics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete the describe.skip block and clean up unused imports</name>
  <files>src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts</files>
  <action>
1. **Delete** the entire `describe.skip('Widget Health Metrics', () => { ... })` block (lines 161-436). This removes all 12 skipped tests that test deprecated no-op stub functions.

2. **Remove unused imports** that were only used by the deleted tests. After deletion, the following imports from `@/lib/observability/widgetHealthMetrics` are no longer needed:
   - `clearAllCounters` (only used in beforeEach inside the deleted block)
   - `getBufferedEvents` (only used in deleted tests)
   - `getFailuresByLayer` (only used in deleted tests)
   - `getHealthDistribution` (only used in deleted tests)
   - `hasCriticalIssues` (only used in deleted tests)
   - `trackHealthChange` (only used in deleted tests)

   Remove the entire import block from `@/lib/observability/widgetHealthMetrics` (lines 8-14) since ALL 6 imported functions were used exclusively in the deleted tests.

3. **Remove the `beforeEach` import** from vitest if it's no longer used. Check: after deleting the describe.skip block, is `beforeEach` used anywhere in the remaining test code? The remaining tests (Schema Validation, Payload Type Inference, Schema Registry, Widget Contracts, Out of Order Timestamp) do NOT have a `beforeEach`. So remove `beforeEach` from the vitest import.

4. **Remove the WidgetHealthStatus type import** (line 23) if no longer referenced. Check: `WidgetHealthStatus` is used in the 'Widget Contracts Existence' test (line 440). KEEP this import.

5. **Verify** the remaining file has clean imports and 4 describe blocks with 21 tests total.

**DO NOT:**

- Modify any of the remaining 21 tests
- Attempt to implement the deprecated functions
- Add new tests to replace the deleted ones
- Change any code in `widgetHealthMetrics.ts`
  </action>
  <verify>

1. `grep -n 'describe.skip' src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts` — returns empty (no skip blocks)
2. `grep -n 'widgetHealthMetrics' src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts` — returns empty (import removed)
3. `grep -n 'clearAllCounters\|getBufferedEvents\|getFailuresByLayer\|getHealthDistribution\|hasCriticalIssues\|trackHealthChange' src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts` — returns empty
4. `cd /home/swoop/swoop-claude-projects/fresh-staged && pnpm test -- --run src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts` — 21 passed, 0 skipped, 0 failed
   </verify>
   <done>describe.skip block deleted (12 tests removed), unused imports cleaned up, 21 remaining tests all pass with zero skips</done>
   </task>

<task type="auto">
  <name>Task 2: Verify full frontend test suite has no regressions</name>
  <files>None (verification only)</files>
  <action>
Run the full frontend test suite to confirm:
1. widgetHealthStates.test.ts shows 21 passed, 0 skipped
2. No other test files are affected by the deletion
3. Total skipped count across frontend decreased by 12

Run: `cd /home/swoop/swoop-claude-projects/fresh-staged && pnpm test -- --run`

Verify the output shows widgetHealthStates.test.ts with only passing tests and no "skip" markers. If any test fails in ANY file, investigate — the deletion should not affect other files since it only removed test code and unused imports.
</action>
<verify>

1. `cd /home/swoop/swoop-claude-projects/fresh-staged && pnpm test -- --run` — exits 0
2. widgetHealthStates.test.ts line in output shows only passes, no skips
3. No new failures in any other test file
   </verify>
   <done>Full frontend test suite passes. widgetHealthStates.test.ts reports 21 passed, 0 skipped. No regressions in other test files.</done>
   </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `describe.skip` does not appear in widgetHealthStates.test.ts
- [ ] No imports from `@/lib/observability/widgetHealthMetrics` in the test file
- [ ] `pnpm test -- --run src/features/dashboard-layout/__tests__/widgetHealthStates.test.ts` — 21 passed, 0 skipped, 0 failed
- [ ] `pnpm test -- --run` (all frontend tests) — exits 0, no regressions
- [ ] The remaining 4 describe blocks are intact: Schema Validation (7), Payload Type Inference (6), Schema Registry (3), Widget Contracts Existence (1), Out of Order Timestamp Detection (4)
</verification>

<success_criteria>

- describe.skip block fully removed from widgetHealthStates.test.ts
- 12 deprecated-function tests deleted (not fixed)
- 21 remaining tests pass
- Zero skipped tests in the file
- No regressions in broader frontend test suite
  </success_criteria>

<must_haves>

- Zero `describe.skip` or `it.skip` markers in widgetHealthStates.test.ts
- 21 tests pass (Schema Validation: 7, Payload Type Inference: 6, Schema Registry: 3, Widget Contracts: 1, Timestamp Detection: 4)
- No imports from deprecated `widgetHealthMetrics` module remain in the test file
- Frontend test suite exits 0 with no new failures
  </must_haves>

<output>
After completion, create `.planning/phases/54-frontend-test-restoration/54-02-SUMMARY.md`
</output>
