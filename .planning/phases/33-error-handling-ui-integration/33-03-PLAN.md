---
phase: 33-error-handling-ui-integration
plan: 03
type: execute
wave: 1
depends_on: ["33-01", "33-02"]
files_modified:
  - src/components/DashboardLayout.tsx
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "MigrationErrorBoundary wraps page content in DashboardLayout"
    - "Migration errors caught by boundary show fallback UI card"
    - "Non-migration errors pass through to parent boundaries unchanged"
    - "Toast messages display with correct migration text"
    - "NotificationDropdown shows empty state gracefully on migration error"
  artifacts:
    - path: "src/components/DashboardLayout.tsx"
      provides: "MigrationErrorBoundary integration"
      contains: "MigrationErrorBoundary"
  key_links:
    - from: "DashboardLayout.tsx"
      to: "MigrationErrorBoundary.tsx"
      via: "import and JSX wrap"
      pattern: "import.*MigrationErrorBoundary"
    - from: "DashboardLayout.tsx"
      to: "children prop"
      via: "wrap in MigrationErrorBoundary"
      pattern: "<MigrationErrorBoundary>.*children.*</MigrationErrorBoundary>"
---

<objective>
Close verification gaps: Integrate MigrationErrorBoundary into DashboardLayout and verify error handling works in running app.

Purpose: The MigrationErrorBoundary component was created in Plan 01 but never integrated into the render tree. Without integration, render-time migration errors will crash the app instead of showing the fallback UI. This plan completes the wiring.

Output: DashboardLayout wraps page content with MigrationErrorBoundary; human-verified toast messages and graceful degradation.
</objective>

<execution_context>
@/home/swoop/.claude/get-shit-done/workflows/execute-plan.md
@/home/swoop/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-error-handling-ui-integration/33-01-SUMMARY.md
@.planning/phases/33-error-handling-ui-integration/33-02-SUMMARY.md
@.planning/phases/33-error-handling-ui-integration/33-VERIFICATION.md

@src/components/DashboardLayout.tsx
@src/components/errors/MigrationErrorBoundary.tsx
@src/components/errors/MigrationErrorFallback.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate MigrationErrorBoundary into DashboardLayout</name>
  <files>src/components/DashboardLayout.tsx</files>
  <action>
1. Import MigrationErrorBoundary from "@/components/errors/MigrationErrorBoundary"
2. In the return JSX, wrap the {children} content (inside the main content area) with MigrationErrorBoundary

The wrap should be around the children specifically, not the entire layout:
- Find the main content area: `<main className="flex-1 lg:ml-64 min-w-0 overflow-x-hidden">`
- Inside it, find `{children}`
- Wrap just `{children}` with `<MigrationErrorBoundary>{children}</MigrationErrorBoundary>`

This ensures:
- Header/sidebar remain functional even if page content has migration errors
- Migration errors in page components are caught and show fallback UI
- Non-migration errors bubble up to parent boundaries as designed

Do NOT wrap the entire DashboardLayout - only the page content children.
  </action>
  <verify>
1. `grep -n "MigrationErrorBoundary" src/components/DashboardLayout.tsx` shows import and JSX usage
2. `npm run build` succeeds without errors
  </verify>
  <done>DashboardLayout imports and uses MigrationErrorBoundary to wrap {children}</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of migration error handling</name>
  <what-built>
MigrationErrorBoundary integration and migration error handling across UI components (from Plans 01, 02, and this plan).
  </what-built>
  <how-to-verify>
Start dev server and test migration error handling:

```bash
npm run dev
```

**Test 1: Verify app loads without crashes**
1. Open http://localhost:5173 in browser
2. Navigate to /dashboard
3. Check browser console for any React errors
4. Expected: App loads, navigation works, no crash

**Test 2: Verify migration error toast (LogTempModal)**
1. Navigate to a page with temperature logging (e.g., unit detail page)
2. Try to log a temperature manually
3. Check for toast notification
4. Expected: Toast appears with "This feature is temporarily unavailable" or similar migration message

**Test 3: Verify NotificationDropdown graceful degradation**
1. Click the notification bell icon in the header
2. Check browser console for migration warning
3. Expected:
   - Dropdown opens without crash
   - Console shows: "[NotificationDropdown] Notifications unavailable during migration" or similar
   - Shows empty/loading state, not error

**Test 4: Verify SuperAdminContext migration handling (if super admin)**
1. If logged in as super admin, navigate to platform admin pages
2. Check for any migration error messages in UI or console
3. Expected: No crashes, migration-related operations show appropriate messages

**Test 5: Verify MigrationErrorBoundary is in render tree**
1. In browser dev tools (React DevTools if installed), inspect component tree
2. Find DashboardLayout component
3. Expected: MigrationErrorBoundary appears as wrapper around page content

Report:
- Did app load without crashes? (yes/no)
- Did toast messages appear? (yes/no/not triggered)
- Did NotificationDropdown degrade gracefully? (yes/no)
- Any issues observed? (describe)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Gap closure verification:

1. **Critical gap closed:** MigrationErrorBoundary integrated into render tree
   - `grep "MigrationErrorBoundary" src/components/DashboardLayout.tsx` returns matches
   - Import statement present
   - JSX wrapper around {children} present

2. **Partial gap closed:** Human verified visual behavior
   - User confirmed toast messages display
   - User confirmed NotificationDropdown graceful degradation
   - User confirmed no crashes on migration errors
</verification>

<success_criteria>
- [ ] MigrationErrorBoundary imported in DashboardLayout.tsx
- [ ] {children} wrapped with MigrationErrorBoundary in JSX
- [ ] Build succeeds (npm run build)
- [ ] Human verified: App loads without crashes
- [ ] Human verified: Migration error handling visible in UI (toast or fallback)
- [ ] Human verified: NotificationDropdown degrades gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/33-error-handling-ui-integration/33-03-SUMMARY.md`
</output>
