# Requirements Archive: v1.0 Self-Hosted MVP

**Archived:** 2026-01-23
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

Requirements for initial release. Each maps to roadmap phases.

### Infrastructure

- [x] **INFRA-01**: Docker Compose starts PostgreSQL 15, PgBouncer, Redis 7, MinIO with passing health checks
- [x] **INFRA-02**: Development scripts (up.sh, down.sh, reset.sh) work on Linux and macOS
- [x] **INFRA-03**: Environment template (.env.example) documented with all required variables

### Database

- [x] **DB-01**: Drizzle ORM configured with TypeScript and drizzle-kit
- [x] **DB-02**: All 17+ Supabase tables defined as Drizzle schemas (22 tables implemented)
- [x] **DB-03**: All 8 enum types defined in schema (14 enums implemented)
- [x] **DB-04**: Foreign key relationships and indexes match Supabase
- [x] **DB-05**: Migrations generate and apply successfully

### Authentication

- [x] **AUTH-01**: Stack Auth project configured with OAuth providers (Google, Microsoft)
- [x] **AUTH-02**: JWT validation middleware extracts and validates tokens
- [x] **AUTH-03**: Invalid/expired tokens return 401 Unauthorized
- [x] **AUTH-04**: Valid tokens populate request.user with user info
- [x] **AUTH-05**: First login creates profile automatically from Stack Auth user
- [x] **AUTH-06**: User ID mapping between Stack Auth and local database

### RBAC

- [x] **RBAC-01**: Role hierarchy enforced (owner > admin > manager > staff > viewer)
- [x] **RBAC-02**: requireRole middleware allows appropriate role levels
- [x] **RBAC-03**: Insufficient role returns 403 with clear message
- [x] **RBAC-04**: Organization context middleware validates org access
- [x] **RBAC-05**: Cross-organization access blocked (tenant isolation)

### Core API

- [x] **API-01**: Organization CRUD endpoints (GET, PUT)
- [x] **API-02**: Organization members list endpoint
- [x] **API-03**: Site CRUD endpoints with admin+ authorization
- [x] **API-04**: Area CRUD endpoints with admin+ authorization
- [x] **API-05**: Unit CRUD endpoints with manager+ authorization
- [x] **API-06**: All endpoints have request validation

### Sensor Data

- [x] **SENS-01**: Readings query API with pagination (start, end, limit, offset)
- [x] **SENS-02**: Bulk readings ingestion endpoint with API key auth
- [x] **SENS-03**: Temperature, device ID, timestamp validation
- [x] **SENS-04**: Readings insertion triggers alert processing

### Alert System

- [x] **ALRT-01**: Alert rules evaluated against readings
- [x] **ALRT-02**: Rule hierarchy resolution (unit → site → org)
- [x] **ALRT-03**: Duplicate alerts not created for ongoing excursions
- [x] **ALRT-04**: Unit status updated based on alert state
- [x] **ALRT-05**: Alert acknowledge endpoint (staff+)
- [x] **ALRT-06**: Alert resolve endpoint (staff+)

### Frontend

- [x] **FE-01**: Typed API client created for all endpoints
- [x] **FE-02**: Token management integrated with Stack Auth
- [~] **FE-03**: All 40+ React hooks migrated to new API client — **PARTIAL** (~30 hooks still use Supabase auth with TODO markers)
- [x] **FE-04**: React Query caching preserved
- [x] **FE-05**: All existing frontend tests pass

### Data Migration

- [x] **MIG-01**: Export scripts dump all tables in dependency order
- [x] **MIG-02**: Export includes metadata (row counts, checksums)
- [x] **MIG-03**: User export from Supabase Auth
- [x] **MIG-04**: Import scripts load tables in dependency order
- [x] **MIG-05**: Supabase user IDs mapped to Stack Auth IDs
- [x] **MIG-06**: Timestamps preserved during import
- [x] **MIG-07**: Verification queries confirm data integrity

### Production Deployment

- [x] **PROD-01**: Production Docker Compose configuration
- [x] **PROD-02**: Resource limits configured for all services
- [x] **PROD-03**: Health checks for all services
- [x] **PROD-04**: Secrets management documented
- [~] **PROD-05**: Cutover procedure documented and tested — **PARTIAL** (data migration pending Supabase access)

---

## Traceability

| Requirement | Phase   | Status   |
| ----------- | ------- | -------- |
| INFRA-01    | Phase 1 | Complete |
| INFRA-02    | Phase 1 | Complete |
| INFRA-03    | Phase 1 | Complete |
| DB-01       | Phase 1 | Complete |
| DB-02       | Phase 1 | Complete |
| DB-03       | Phase 1 | Complete |
| DB-04       | Phase 1 | Complete |
| DB-05       | Phase 1 | Complete |
| AUTH-01     | Phase 2 | Complete |
| AUTH-02     | Phase 2 | Complete |
| AUTH-03     | Phase 2 | Complete |
| AUTH-04     | Phase 2 | Complete |
| AUTH-05     | Phase 2 | Complete |
| AUTH-06     | Phase 2 | Complete |
| RBAC-01     | Phase 2 | Complete |
| RBAC-02     | Phase 2 | Complete |
| RBAC-03     | Phase 2 | Complete |
| RBAC-04     | Phase 2 | Complete |
| RBAC-05     | Phase 2 | Complete |
| API-01      | Phase 3 | Complete |
| API-02      | Phase 3 | Complete |
| API-03      | Phase 3 | Complete |
| API-04      | Phase 3 | Complete |
| API-05      | Phase 3 | Complete |
| API-06      | Phase 3 | Complete |
| SENS-01     | Phase 4 | Complete |
| SENS-02     | Phase 4 | Complete |
| SENS-03     | Phase 4 | Complete |
| SENS-04     | Phase 4 | Complete |
| ALRT-01     | Phase 4 | Complete |
| ALRT-02     | Phase 4 | Complete |
| ALRT-03     | Phase 4 | Complete |
| ALRT-04     | Phase 4 | Complete |
| ALRT-05     | Phase 4 | Complete |
| ALRT-06     | Phase 4 | Complete |
| FE-01       | Phase 5 | Complete |
| FE-02       | Phase 5 | Complete |
| FE-03       | Phase 5 | Partial  |
| FE-04       | Phase 5 | Complete |
| FE-05       | Phase 5 | Complete |
| MIG-01      | Phase 6 | Complete |
| MIG-02      | Phase 6 | Complete |
| MIG-03      | Phase 6 | Complete |
| MIG-04      | Phase 6 | Complete |
| MIG-05      | Phase 6 | Complete |
| MIG-06      | Phase 6 | Complete |
| MIG-07      | Phase 6 | Complete |
| PROD-01     | Phase 7 | Complete |
| PROD-02     | Phase 7 | Complete |
| PROD-03     | Phase 7 | Complete |
| PROD-04     | Phase 7 | Complete |
| PROD-05     | Phase 7 | Partial  |

**Coverage:**

- v1 requirements: 52 total
- Mapped to phases: 52
- Complete: 50 (96%)
- Partial: 2 (FE-03, PROD-05)
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 50 of 52 v1 requirements (96%)

**Adjusted during implementation:**

- DB-02: Increased from 17+ to 22 tables
- DB-03: Increased from 8 to 14 enum types
- FE-03: ~30 hooks remain on Supabase auth (hybrid state accepted for v1.0)

**Deferred:**

- None dropped — partial requirements accepted as tech debt

---

_Archived: 2026-01-23 as part of v1.0 milestone completion_
