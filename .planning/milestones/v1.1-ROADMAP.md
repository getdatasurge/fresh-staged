# Milestone v1.1: Production Ready

**Status:** SHIPPED 2026-01-24
**Phases:** 8-13
**Total Plans:** 31

## Overview

Complete frontend auth cleanup, validate end-to-end pipeline, and enable flexible deployment to cloud or self-hosted infrastructure.

## Phases

### Phase 8: Frontend Auth Cleanup

**Goal**: Migrate all frontend Supabase auth calls to Stack Auth
**Depends on**: Phase 7
**Requirements**: AUTH-01, AUTH-03 (AUTH-02 blocked)
**Plans**: 6 plans

Plans:

- [x] 08-01: Migrate hooks (useBranding, useNavTree, useSoftDelete, useAccountDeletion)
- [x] 08-02: Migrate simple components (PlatformLayout, UnitSettingsSection, etc.)
- [x] 08-03: Migrate complex components (AlertRulesEditor, TTNCredentialsPanel, etc.)
- [x] 08-04: Migrate simple pages (Alerts, RecentlyDeleted, TTNCleanup, etc.)
- [x] 08-05: Migrate complex pages (Dashboard, ManualLog, Reports, etc.)
- [x] 08-06: Cleanup and verification

**Success Criteria:**

1. User can authenticate using only Stack Auth (no Supabase auth calls)
2. All frontend hooks reference Stack Auth hooks (no supabase.auth usage)
3. Authentication flows (login, logout, session management) work without Supabase auth
4. instrumentedSupabase.ts deleted (unused wrapper)

**Note**: AUTH-02 (removing @supabase/supabase-js from package.json) is BLOCKED - 100+ files still use Supabase for database queries.

---

### Phase 9: Production Environment Hardening

**Goal**: Production-ready Docker Compose configuration with secrets management and resource controls
**Depends on**: Phase 8
**Requirements**: HARD-01, HARD-02, HARD-03, HARD-04, HARD-05, HARD-06
**Plans**: 6 plans

Plans:

- [x] 09-01: Infisical secrets manager stack setup
- [x] 09-02: Production base configuration (resource limits, logging)
- [x] 09-03: Deployment target overlays (self-hosted, DigitalOcean)
- [x] 09-04: Build security (.dockerignore enhancements)
- [x] 09-05: Deployment notification script
- [x] 09-06: Verification and checkpoint

**Success Criteria:**

1. Sensitive credentials stored in Docker Secrets (not environment variables visible in docker inspect)
2. All services have resource limits configured (memory, CPU) preventing runaway containers
3. All services have health checks configured enabling zero-downtime deployments
4. Production docker-compose override file exists with production-specific settings
5. Docker builds exclude secrets (.env files, keys never appear in image layers)

---

### Phase 10: Database Production Readiness

**Goal**: PgBouncer connection pooling enabled with automated backup system
**Depends on**: Phase 9
**Requirements**: DB-01, DB-02, DB-03, DB-04, DB-05
**Plans**: 6 plans

Plans:

- [x] 10-01: PgBouncer configuration and metrics exporter
- [x] 10-02: Blackbox Exporter and SSL certificate monitoring
- [x] 10-03: Automated PostgreSQL backup system
- [x] 10-04: Backend PgBouncer compatibility audit
- [x] 10-05: Backup restoration procedure and documentation
- [x] 10-06: Phase verification checkpoint

**Success Criteria:**

1. Backend connects to PostgreSQL through PgBouncer (transaction pooling mode working)
2. Backend code compatible with PgBouncer transaction mode (no prepared statements, SET commands audited)
3. Database backups run automatically daily (pg_dump to MinIO with retention policy)
4. Backup restoration procedure documented and tested (can restore to point-in-time)
5. SSL certificate expiration monitoring alerts 30 days before expiry

---

### Phase 11: Self-Hosted Deployment

**Goal**: Validated deployment to self-hosted VM with automated SSL
**Depends on**: Phase 10
**Requirements**: DEPLOY-01, DEPLOY-02, DEPLOY-03
**Plans**: 4 plans

Plans:

- [x] 11-01: Configuration template and deploy-selfhosted.sh base script
- [x] 11-02: SSL certificate documentation (individual and wildcard)
- [x] 11-03: DNS pre-check, health validation, and automatic rollback
- [x] 11-04: Complete deployment documentation and verification

**Success Criteria:**

1. Self-hosted deployment documentation guides from bare VM to running application
2. Deployment script automates VM setup (deploy-selfhosted.sh with health checks)
3. SSL/TLS certificates auto-renew with Let's Encrypt (no manual intervention required)
4. Application accessible via HTTPS with valid certificate
5. Rollback procedure tested and documented for self-hosted deployments

---

### Phase 12: DigitalOcean Deployment

**Goal**: Validated deployment to DigitalOcean Droplet with managed database option
**Depends on**: Phase 11
**Requirements**: DEPLOY-04, DEPLOY-05, DEPLOY-06
**Plans**: 4 plans

Plans:

- [x] 12-01: DigitalOcean configuration and doctl helper functions
- [x] 12-02: Droplet provisioning script (deploy-digitalocean.sh)
- [x] 12-03: Managed PostgreSQL integration
- [x] 12-04: Documentation and cost comparison (with verification checkpoint)

**Success Criteria:**

1. DigitalOcean deployment documentation complete (Droplet setup, managed DB integration)
2. DigitalOcean deployment script validated (deploy-do.sh automates Droplet provisioning)
3. Managed PostgreSQL integration documented (connection string configuration, SSL setup)
4. Application deployed successfully to DigitalOcean with managed database
5. Cost comparison documented (self-hosted vs managed services)

---

### Phase 13: E2E Validation & Cutover

**Goal**: End-to-end pipeline validated with production-ready procedures
**Depends on**: Phase 12
**Requirements**: TEST-01, TEST-02, TEST-03, TEST-04
**Plans**: 5 plans

Plans:

- [x] 13-01: E2E sensor pipeline validation script (TEST-01)
- [x] 13-02: Alert notification pipeline test (TEST-02)
- [x] 13-03: Migration timing validation with synthetic data (TEST-03)
- [x] 13-04: Deployment decision guide documentation
- [x] 13-05: Zero-downtime validation and final checklist (TEST-04)

**Success Criteria:**

1. Sensor data flows from ingestion → storage → alert trigger on self-hosted deployment
2. Alert notifications delivered successfully (email, webhook tested end-to-end)
3. Migration procedure tested with production-sized dataset (timing validated)
4. Zero-downtime deployment validated (health checks prevent traffic to unhealthy containers)
5. Deployment decision guide exists (which target to choose based on requirements)

---

## Milestone Summary

**Key Decisions:**

- Docker Compose override pattern for multi-target deployment (base + compose.{target}.yaml)
- Start with self-hosted/DigitalOcean Droplet before AWS ECS (lower complexity)
- PgBouncer transaction pooling mode (must audit backend code compatibility)
- Hook wrapper pattern for auth-dependent functions (08-01)
- useStackApp for auth actions, useUser for identity (08-02)
- Stack Auth useUser() reactivity replaces onAuthStateChange subscriptions (08-03)
- Bash-based E2E testing for deployment portability vs Node.js/Jest (13-01)
- Scenario-based deployment guide with monthly cost estimates (13-04)
- Health check-based zero-downtime validation with >95% success rate target (13-05)

**Issues Resolved:**

- FE-03: ~30 hooks still use Supabase auth → All migrated to Stack Auth
- verify.ts checksum not tested → Validated via TEST-03 migration timing tests
- PgBouncer disabled → Enabled with transaction mode and ORM compatibility

**Issues Deferred:**

- AUTH-02: @supabase/supabase-js removal (blocked by 100+ files using for DB queries)
- Production data migration (no Supabase access)

**Technical Debt Incurred:**

- Supabase client retained in package.json for database queries (fix in v2.0 with backend API migration)

---

_For current project status, see .planning/ROADMAP.md_
