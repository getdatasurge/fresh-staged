# Requirements Archive: v2.7 tRPC Client Fix

**Archived:** 2026-01-30
**Status:** SHIPPED

This is the archived requirements specification for v2.7.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: FreshTrack Pro v2.7

**Defined:** 2026-01-29
**Core Value:** Food safety data must flow reliably from sensors to alerts without interruption.

## v2.7 Requirements — tRPC Client Fix

Fix the tRPC runtime crash preventing React from mounting in production. The app's infrastructure (14 containers, API, SSL) works but the SPA never renders due to `TypeError: e[i] is not a function` in the tRPC proxy layer.

### Dependency Cleanup

- [x] **DEP-01**: Remove `@trpc/react-query` from package.json (phantom dependency, not imported)
- [x] **DEP-02**: Pin all tRPC packages (`@trpc/client`, `@trpc/server`, `@trpc/tanstack-react-query`) to 11.9.0
- [x] **DEP-03**: Upgrade frontend Zod from v3 to v4 to match backend

### tRPC Proxy Fix

- [x] **TRPC-01**: All `.mutate()` calls on `useTRPC()` proxy replaced with `useTRPCClient()` pattern
- [x] **TRPC-02**: All `.query()` calls on `useTRPC()` proxy replaced with `useTRPCClient()` pattern
- [x] **TRPC-03**: React mounts successfully (no `TypeError: e[i] is not a function`)
- [x] **TRPC-04**: All existing frontend tests pass after proxy call changes

### Production Deployment

- [x] **PROD-01**: Frontend rebuilt and redeployed to 192.168.4.181
- [x] **PROD-02**: App renders in browser (React mounts, `#root` has children)
- [x] **PROD-03**: Playwright smoke tests pass with React rendering verified

## Out of Scope

| Feature                    | Reason                           |
| -------------------------- | -------------------------------- |
| New features or UI changes | Fix only, no feature work        |
| Backend changes            | tRPC server is working correctly |
| Test coverage expansion    | Fix existing tests only          |
| Domain/SSL changes         | Infrastructure already working   |

## Traceability

| Requirement | Phase    | Status   |
| ----------- | -------- | -------- |
| DEP-01      | Phase 46 | Complete |
| DEP-02      | Phase 46 | Complete |
| DEP-03      | Phase 46 | Complete |
| TRPC-01     | Phase 47 | Complete |
| TRPC-02     | Phase 47 | Complete |
| TRPC-03     | Phase 47 | Complete |
| TRPC-04     | Phase 47 | Complete |
| PROD-01     | Phase 48 | Complete |
| PROD-02     | Phase 48 | Complete |
| PROD-03     | Phase 48 | Complete |

**Coverage:**

- v2.7 requirements: 10 total
- Mapped to phases: 10
- Unmapped: 0

---

## Milestone Summary

**Shipped:** 10 of 10 requirements
**Adjusted:** None — all requirements delivered as originally specified
**Dropped:** None

---

_Archived: 2026-01-30 as part of v2.7 milestone completion_
