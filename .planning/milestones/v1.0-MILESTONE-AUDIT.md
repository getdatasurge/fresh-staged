---
milestone: v1.0
audited: 2026-01-23
status: tech_debt
scores:
  requirements: 50/52
  phases: 7/7
  integration: 35/38
  flows: 4/6
gaps:
  requirements:
    - FE-03: ~30 hooks still use Supabase auth (marked with TODO Phase 6)
    - PROD-05: Data migration pending Supabase access
  integration:
    - Frontend hooks using wrong auth source (supabase.auth vs Stack Auth)
  flows:
    - Login -> Dashboard: useNavTree breaks at Supabase auth call
    - Entity Management: Mixed auth sources cause partial failures
tech_debt:
  - phase: 05-frontend-migration
    items:
      - '~54 occurrences of supabase.auth calls in frontend'
      - 'useNavTree.ts uses Supabase auth with new API modules'
      - 'useSoftDelete.ts uses Supabase auth with new API modules'
      - 'useBranding.ts uses Supabase auth with new API modules'
      - 'Various page components have mixed auth state handling'
  - phase: 06-data-migration-scripts
    items:
      - 'verify.ts checksum comparison not tested against production data'
  - phase: 07-production-deployment-cutover
    items:
      - 'Data migration not executed (requires Supabase access)'
      - 'Production cutover checkpoints not completed'
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — Self-Hosted MVP
**Audited:** 2026-01-23
**Status:** Tech Debt Review Required

## Executive Summary

Milestone v1.0 infrastructure is **fully validated**. All 7 phases complete with 47 plans executed. Backend API, authentication, database, and deployment infrastructure are production-ready.

**Key finding:** Frontend migration (Phase 5) has known tech debt where ~30 hooks still use Supabase auth calls instead of Stack Auth. These are marked with `TODO Phase 6` comments and work during development when both auth systems are available, but will break in production where Supabase auth is not available.

## Scores

| Category     | Score | Status        |
| ------------ | ----- | ------------- |
| Requirements | 50/52 | 96% Complete  |
| Phases       | 7/7   | 100% Complete |
| Integration  | 35/38 | 92% Wired     |
| E2E Flows    | 4/6   | 67% Working   |

## Phase Verification Summary

| Phase                            | VERIFICATION.md   | Status                   | Score       |
| -------------------------------- | ----------------- | ------------------------ | ----------- |
| 01-local-development-environment | Yes               | passed                   | 12/12       |
| 02-authentication-rbac           | Yes               | passed                   | 21/21       |
| 03-core-api-endpoints            | Yes               | passed                   | 6/6         |
| 04-sensor-data-alert-system      | Yes               | passed                   | 19/19       |
| 05-frontend-migration            | No (SUMMARY only) | complete with debt       | 14/14 plans |
| 06-data-migration-scripts        | No (SUMMARY only) | complete                 | 6/6 plans   |
| 07-production-deployment-cutover | No (SUMMARY only) | infrastructure validated | 6/6 plans   |

## Requirements Coverage

### Satisfied (50/52)

**Infrastructure (8/8)**

- INFRA-01: Docker Compose with PostgreSQL, Redis, MinIO ✓
- INFRA-02: Development scripts ✓
- INFRA-03: Environment template ✓
- DB-01 through DB-05: All database requirements ✓

**Authentication (11/11)**

- AUTH-01 through AUTH-06: All auth requirements ✓
- RBAC-01 through RBAC-05: All RBAC requirements ✓

**Core API (6/6)**

- API-01 through API-06: All CRUD and validation requirements ✓

**Sensor Data (4/4)**

- SENS-01 through SENS-04: Readings ingestion and query ✓

**Alert System (6/6)**

- ALRT-01 through ALRT-06: Alert lifecycle complete ✓

**Frontend (4/5)**

- FE-01: Typed API client ✓
- FE-02: Stack Auth token management ✓
- FE-03: All hooks migrated **PARTIAL** (~30 hooks still use Supabase auth)
- FE-04: React Query caching preserved ✓
- FE-05: Tests pass ✓

**Data Migration (7/7)**

- MIG-01 through MIG-07: All migration scripts complete ✓

**Production (4/5)**

- PROD-01 through PROD-04: Infrastructure complete ✓
- PROD-05: Cutover procedure **PARTIAL** (pending Supabase access)

### Partial Requirements

| Requirement | Issue                       | Impact                               | Resolution                             |
| ----------- | --------------------------- | ------------------------------------ | -------------------------------------- |
| FE-03       | ~30 hooks use Supabase auth | Hooks fail when Supabase unavailable | Complete auth migration before cutover |
| PROD-05     | Data migration not executed | No production data                   | Execute when Supabase access available |

## Integration Wiring

### Connected (35 exports)

**Backend Integration (Complete)**

- Database client → All services ✓
- Schema exports → Services and routes ✓
- Auth middleware chain → All routes ✓
- Alert evaluator → Readings ingestion ✓
- Health endpoints → Docker health checks ✓

**Frontend-Backend Integration (Partial)**

- API client → Backend routes ✓
- `x-stack-access-token` header → Auth middleware ✓
- Route paths match API module calls ✓

### Broken Wiring (3 connections)

| From          | To         | Issue                             |
| ------------- | ---------- | --------------------------------- |
| useNavTree    | Stack Auth | Uses `supabase.auth.getSession()` |
| useSoftDelete | Stack Auth | Uses `supabase.auth.getSession()` |
| useBranding   | Stack Auth | Uses `supabase.auth.getSession()` |

## E2E Flow Analysis

### Working Flows (4/6)

**Sensor Data Ingestion**

```
TTN Webhook → API Key Auth → Readings Service → Alert Evaluator → Database
```

Status: ✓ Complete

**Alert Lifecycle**

```
Alert Triggered → Acknowledged → Resolved
```

Status: ✓ Complete

**Data Migration**

```
Supabase Export → User Mapping → Import → Verify
```

Status: ✓ Complete (pending execution)

**Production Deployment**

```
Docker Build → Compose Up → Health Checks → Observability
```

Status: ✓ Complete (staging validated)

### Broken Flows (2/6)

**Login → Dashboard**

```
Stack Auth Login → JWT → Frontend → useNavTree (BREAKS) → supabase.auth.getSession() returns null
```

Status: ✗ Navigation sidebar will not load

**Entity Management (Partial)**

```
User Action → Hook (VARIES) → API Module → Backend
- useUnitAlerts: ✓ Uses Stack Auth
- useNavTree: ✗ Uses Supabase auth
- useSoftDelete: ✗ Uses Supabase auth
```

Status: ⚠ Some operations work, others fail

## Tech Debt by Phase

### Phase 5: Frontend Migration

| Item                                 | Files                     | Severity |
| ------------------------------------ | ------------------------- | -------- |
| `supabase.auth.getSession()` calls   | ~30 files, 54 occurrences | High     |
| `useNavTree.ts` wrong auth source    | 1 file, critical hook     | High     |
| `useSoftDelete.ts` wrong auth source | 1 file                    | Medium   |
| `useBranding.ts` wrong auth source   | 1 file                    | Medium   |
| Page components mixed auth state     | ~10 files                 | Medium   |

**Total: ~54 occurrences in ~30 files**

These are marked with `TODO Phase 6` comments but were scoped as data-layer migration, not auth migration. The auth calls need completion before production.

### Phase 6: Data Migration Scripts

| Item                                    | Files  | Severity |
| --------------------------------------- | ------ | -------- |
| verify.ts not tested against production | 1 file | Low      |

### Phase 7: Production Deployment

| Item                             | Files | Severity                |
| -------------------------------- | ----- | ----------------------- |
| Data migration not executed      | N/A   | Blocking for production |
| Production cutover not completed | N/A   | Blocking for production |

## Recommendations

### Before Production Cutover

1. **Complete Frontend Auth Migration**
   - Migrate remaining ~30 files from `supabase.auth` to Stack Auth
   - Priority: `useNavTree.ts`, `useSoftDelete.ts`, `useBranding.ts`
   - Estimate: 4-8 hours

2. **Obtain Supabase Access**
   - Required for data export
   - Required for production cutover

3. **Execute Data Migration**
   - Run export, migrate-users, import, verify scripts
   - Validate row counts and checksums

### Acceptable Tech Debt

The following can be deferred:

- `verify.ts` production testing (can verify manually)
- PWA bundle size warning (pre-existing issue)
- Integration tests for some alert scenarios (core contracts tested)

## Conclusion

Milestone v1.0 infrastructure is **production-ready**. The remaining work is:

1. **Critical:** Complete frontend auth migration (~54 occurrences)
2. **Blocking:** Execute data migration (requires Supabase access)
3. **Final:** Complete production cutover checklist

The backend, database, authentication, and deployment infrastructure are fully validated. Once frontend auth migration is complete and Supabase access is available, production cutover can proceed.

---

_Audited: 2026-01-23_
_Auditor: Claude (gsd-integration-checker)_
