# Milestone v2.5: TTN Test Fixes

**Status:** ✅ SHIPPED 2026-01-29
**Phases:** 44
**Total Plans:** 1

## Overview

Fix the 15 pre-existing test failures in the TTN device bootstrap endpoint. These tests had been failing since before the tRPC migration due to unmocked subscription middleware making database queries.

## Phases

### Phase 44: TTN Bootstrap Fix

**Goal**: Fix TTN device bootstrap endpoint to return correct HTTP status codes and pass all tests
**Depends on**: Nothing (isolated fix)
**Plans**: 1 plan

Plans:
- [x] 44-01-PLAN.md — Mock subscription middleware in TTN device tests

**Details:**
Root cause: `requireSensorCapacity` middleware made database queries without mocking, causing 500 errors instead of expected status codes (201, 400, 401, 403).

Solution: Added `vi.mock` for subscription middleware following existing patterns (same as JWT/user service mocks).

---

## Milestone Summary

**Key Decisions:**
- Mock middleware instead of database: Following existing pattern where auth middleware is mocked. Subscription logic should be tested in dedicated subscription tests, not TTN device tests.

**Issues Resolved:**
- Fixed all 15 failing tests in `ttn-devices.test.ts`
- All 45 TTN device tests now pass

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

*For current project status, see .planning/ROADMAP.md*
