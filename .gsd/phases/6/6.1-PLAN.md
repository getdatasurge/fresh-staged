---
phase: 6
plan: 1
wave: 1
---

# Plan 6.1: Complete Remaining Supabase to tRPC Migrations

## Objective

Complete all remaining Supabase to tRPC migrations, focusing on medium and low priority tasks, creating the missing Areas.tsx page, and migrating Settings.tsx to full tRPC implementation.

## Context

- `.gsd/STATE.md` - Current position: Phase 5 complete, remaining Supabase calls documented
- `.gsd/phases/5/remaining-supabase-calls.md` - List of remaining Supabase calls
- `.gsd/SPEC.md` - tRPC refactor specification
- `.gsd/ROADMAP.md` - Migration roadmap
- `src/` - Frontend React app
- `backend/src/` - Node.js backend

## Tasks

<task type="auto">
  <name>Create Areas.tsx page</name>
  <files>src/pages/Areas.tsx, backend/src/routers/areas.router.ts, backend/src/services/areas.service.ts, src/hooks/useAreas.ts</files>
  <action>
    1. Create backend areas router with tRPC procedures for CRUD operations
    2. Implement areas service with database operations
    3. Create frontend hook useAreas.ts using tRPC
    4. Implement Areas.tsx page with list view and basic functionality
    5. Add routing for the areas page
  </action>
  <verify>
    - Areas page loads correctly
    - Data is fetched and displayed using tRPC
    - Routing works properly
    - Page is accessible from navigation
  </verify>
  <done>Areas.tsx page created and functioning with tRPC.</done>
</task>

<task type="auto">
  <name>Migrate Settings.tsx to full tRPC implementation</name>
  <files>src/pages/Settings.tsx, backend/src/routers/settings.router.ts, backend/src/services/settings.service.ts, src/hooks/useSettings.ts</files>
  <action>
    1. Create backend settings router with tRPC procedures
    2. Implement settings service with database operations
    3. Create frontend hook useSettings.ts using tRPC
    4. Update Settings.tsx to use tRPC instead of direct Supabase calls
    5. Remove remaining Supabase dependencies from settings page
  </action>
  <verify>
    - Settings page loads correctly
    - All data is fetched and updated using tRPC
    - No remaining Supabase calls in settings page
    - Functionality works as expected
  </verify>
  <done>Settings.tsx fully migrated to tRPC.</done>
</task>

<task type="auto">
  <name>Migrate medium priority Supabase calls</name>
  <files>src/hooks/useTTNOperations.ts, src/hooks/useSoftDelete.ts, src/lib/health/healthChecks.ts</files>
  <action>
    1. Create backend tRPC procedures for TTN operations
    2. Create backend tRPC procedures for soft delete functionality
    3. Create backend tRPC procedures for health check system
    4. Update frontend hooks to use tRPC instead of direct Supabase calls
  </action>
  <verify>
    - All medium priority calls now use tRPC
    - Functionality remains intact
    - Tests pass
  </verify>
  <done>Medium priority Supabase calls migrated to tRPC.</done>
</task>

<task type="auto">
  <name>Migrate low priority Supabase calls</name>
  <files>src/hooks/useTTNDeprovision.ts, src/hooks/useTTNWebhook.ts</files>
  <action>
    1. Create backend tRPC procedures for TTN deprovisioning
    2. Create backend tRPC procedures for TTN webhook management
    3. Update frontend hooks to use tRPC instead of direct Supabase calls
  </action>
  <verify>
    - All low priority calls now use tRPC
    - Functionality remains intact
    - Tests pass
  </verify>
  <done>Low priority Supabase calls migrated to tRPC.</done>
</task>

<task type="auto">
  <name>Remove deprecated API files</name>
  <files>src/lib/api/*.ts</files>
  <action>
    1. Remove unused legacy API files
    2. Cleanup deprecated API modules
    3. Update imports and dependencies
  </action>
  <verify>
    - Deprecated API files removed
    - Project builds without errors
    - All tests pass
  </verify>
  <done>Deprecated API files removed and project clean.</done>
</task>

## Success Criteria

- [ ] Areas.tsx page created and functioning with tRPC
- [ ] Settings.tsx fully migrated to tRPC
- [ ] All medium priority Supabase calls migrated to tRPC
- [ ] All low priority Supabase calls migrated to tRPC
- [ ] Deprecated API files removed
- [ ] Project builds without errors
- [ ] All tests pass

## Notes

- Prioritize high-impact tasks first (Areas.tsx and Settings.tsx)
- Ensure all functionality remains intact when removing deprecated files
- Test each migration thoroughly to avoid breaking changes
- Follow tRPC best practices when implementing new procedures
