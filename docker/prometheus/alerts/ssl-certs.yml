# SSL Certificate Monitoring Alert Rules
# These rules fire alerts when SSL certificates are approaching expiry

groups:
  - name: ssl_certificates
    rules:
      # Warning: Certificate expires in less than 30 days
      - alert: SSLCertExpiring30Days
        expr: probe_ssl_earliest_cert_expiry - time() < 86400 * 30
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "SSL certificate expires in less than 30 days"
          description: "Certificate for {{ $labels.instance }} expires in {{ $value | humanizeDuration }}. Renewal recommended."

      # Critical: Certificate expires in less than 7 days
      - alert: SSLCertExpiring7Days
        expr: probe_ssl_earliest_cert_expiry - time() < 86400 * 7
        for: 30m
        labels:
          severity: critical
        annotations:
          summary: "SSL certificate expires in less than 7 days - URGENT"
          description: "Certificate for {{ $labels.instance }} expires in {{ $value | humanizeDuration }}. Immediate renewal required."

      # SSL probe failed - endpoint unreachable or SSL error
      - alert: SSLProbeFailure
        expr: probe_success{job="ssl-certs"} == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "SSL probe failed for endpoint"
          description: "SSL probe failed for {{ $labels.instance }}. Check if endpoint is reachable and certificate is valid."
